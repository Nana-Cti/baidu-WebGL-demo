/**/ï»¿_jsload&&_jsload('poly', 'w.DOM_ATTRS={strokecolor:1,strokeweight:1,strokeopacity:1,fillcolor:1,fillopacity:1,strokelinecap:1,strokelinejoin:1,strokestyle:1,topfillcolor:1,topfillopacity:1,sidefillcolor:1,sidefillopacity:1};C.extend(w.prototype,{initialize:function(T){if(T&&this._graphMouseEvent){T.addEventListener("onmousemove",this._graphMouseEvent)}if(T&&this._graphClickEvent){T.addEventListener("onclick",this._graphClickEvent);T.addEventListener("ondblclick",this._graphClickEvent);T.addEventListener("onrightclick",this._graphClickEvent);T.addEventListener("onrightdblclick",this._graphClickEvent)}if((this._config.strokeStyle==="dashed"||this._config.strokeStyle==="dotted")&&T.getRenderType()==="webgl"&&!this._config.texture){this._generateTexture()}var e=cV.prototype.initialize.call(this,T);if(this._config.enableEditing===true&&!this._config.geodesic){var i=this;setTimeout(function(){i.clearVertexs();i.addVertexs()},0)}return e},_generateTexture:function(){var hT=this._config;var T=hT.dashArray;var hS=document.createElement("canvas");var e;var hR;if(hT.strokeStyle==="dashed"){e=16;hR=e*8}else{if(hT.strokeStyle==="dotted"){e=32;hR=e*2}}hS.width=e;hS.height=hR;var i=hS.getContext("2d");i.fillStyle=hT.strokeColor;i.globalAlpha=hT.strokeOpacity;if(hT.strokeStyle==="dashed"){this._drawDashArrayTexture(i,e,hR)}else{if(hT.strokeStyle==="dotted"){this._drawDottedTexture(i,e,hR)}}this._config.texture=hS;this._config.textureSize=[e,hR]},_drawDashArrayTexture:function(hX,hR,hT){var T=this._config;var hV=T.dashArray;if(!hV){hX.fillRect(0,0,hR,hT/2);this._totalDashLen=T.strokeWeight*4}else{var hW=0;if(hV.length%2!==0){hV=hV.concat(hV)}for(var hS=0;hS<hV.length;hS++){hW+=hV[hS]}var e=0;for(var hS=0;hS<hV.length;hS++){var hU=hV[hS]/hW*hT;if(hS%2===0){hX.fillRect(0,e,hR,hU)}e+=hU}this._totalDashLen=hW}},_drawDottedTexture:function(i,e,T){i.beginPath();i.arc(e/2,e/2,e/2,0,2*Math.PI);i.fill();i.closePath();this._totalDashLen=this._config.strokeWeight*2},_addDom:function(){if(this.map._renderType==="webgl"){return}var e=this._drawer=bw.getDrawer(this.map);this.domElement=e.addLine()},_bind:function(){var e=this.domElement;var hR=this;function hT(hZ,hX){var hW=hZ.srcElement||hZ.target;var hV=fJ();var i=hZ.pageX?hZ.pageX:(hZ.clientX+hV[1]);var h1=hZ.pageY?hZ.pageY:(hZ.clientY+hV[0]);if(hZ&&hX&&i&&h1&&hW){var hY=C.I(hW.hashCode).map;var h0=C.Dom.getOffset(hY.container);hX.pixel=new ej(i-h0.left,h1-h0.top);hX.point=hY.pixelToPointIn(hX.pixel);hX.latLng=hY.pixelToPoint(hX.pixel);return hX}else{return hX}}if(e&&bw.getDrawer(this.map).getType()!=="canvas"){C.on(e,"click",function(i){hR.dispatchEvent(hT(i,new bb("onclick").inherit(i)))});C.on(e,"mousedown",function(i){hR.dispatchEvent(hT(i,new bb("onmousedown").inherit(i)))});C.on(e,"mouseup",function(i){hR.dispatchEvent(hT(i,new bb("onmouseup").inherit(i)))});C.on(e,"dblclick",function(i){hR.dispatchEvent(hT(i,new bb("ondblclick").inherit(i)))})}e=null;if(!this._binded){this._binded=true;this.enableEventListen=true;this._graphMouseEvent=function(hY){if(!hR.map){return}if(hR.map.getMapType()==="B_EARTH_MAP"){return}if(hR instanceof bo.PolylineMultipart||hR instanceof bo.Marker3D){return}if(hR.map.temp._draggingMarker){return}if(!hR.enableEventListen){return}var hV;if(hY.overlay&&hY.overlay.toString()==="Marker"){if(!hY.overlay.keepWhenMousemoveOn){if(hR._temp.ismouseout===false&&hR._temp.ismouseover===true){hR._temp.ismouseover=false;hR._temp.ismouseout=true;hV=new bb("onmouseout");hR.dispatchEvent(hV)}return}}var i=hY.point;var hX;if(hR.toString()!=="Polyline"){hX=hR._getInPnpoly(i)}else{hX=hR._getProximity(i)}var hW=hX.dist;if(hW>=0&&hW<hR._config.mouseOverTolerance){if(!hR._temp.ismouseover){hR._temp.ismouseover=true;hR._temp.ismouseout=false;hV=new bb("onmouseover")}else{hV=new bb("onmousemove");hR.map.platform.style.cursor="pointer"}}else{if(!hR._temp.ismouseout&&hR._temp.ismouseover){hR._temp.ismouseover=false;hR._temp.ismouseout=true;hV=new bb("onmouseout");hR.map.platform.style.cursor=hR.map.config.defaultCursor}}if(hV){if(hR.toString()!=="Polyline"&&hV.type==="onmousemove"&&hR._temp.ismouseover===true&&(hW===0||hW>hR._config.mouseOverTolerance)){hV.pixel=hY.pixel;hV.point=hY.point;hV.latLng=this.overlayPixelToPoint(hY.pixel)}else{hV.point=this.overlayPixelToPointIn(hX.pixel);hV.pixel=this.pointToPixelIn(hV.point);hV.latLng=this.overlayPixelToPoint(hX.pixel)}hR.dispatchEvent(hV)}};this._graphClickEvent=function(hY){if(!hR.map){return}if(hR.map.getMapType()==="B_EARTH_MAP"){return}if(hR instanceof bo.PolylineMultipart||hR instanceof bo.Marker3D){return}if(hR.map.temp._draggingMarker){return}if(!hR.enableEventListen){return}var hV;var i=hY.point;var hX;if(hR.toString()!=="Polyline"){hX=hR._getInPnpoly(i)}else{hX=hR._getProximity(i)}var hW=hX.dist;if(hW>=0&&hW<hR._config.mouseOverTolerance){hV=new bb(hY.type)}if(hV){if(hR.toString()!=="Polyline"&&hV.type==="onmousemove"&&hR._temp.ismouseover===true&&(hW===0||hW>hR._config.mouseOverTolerance)){hV.pixel=hY.pixel;hV.point=hY.point;hV.latLng=this.overlayPixelToPoint(hY.pixel)}else{hV.point=this.overlayPixelToPointIn(hX.pixel);hV.pixel=this.pointToPixelIn(hV.point);hV.latLng=this.overlayPixelToPoint(hX.pixel)}hR.dispatchEvent(hV)}};this.map.addEventListener("onmousemove",this._graphMouseEvent);var hS=["onclick","dblclick","onrightclick","onrightdblclick"];for(var T=0;T<hS.length;T++){var hU=hS[T];this.map.addEventListener(hU,this._graphClickEvent)}this.addEventListener("mouseover",function(i){if(!this.map){return}});this.addEventListener("mouseout",function(i){if(!this.map){return}});this.map.addEventListener("movestart",function(){hR.enableEventListen=false;hR._mouseEventPixels=null});this.map.addEventListener("moveend",function(){hR.enableEventListen=true});this.map.addEventListener("zoomstart",function(){hR.enableEventListen=false;hR._mouseEventPixels=null});this.map.addEventListener("zoomend",function(){hR.enableEventListen=true});this.map.on("center_changed",function(){hR._mouseEventPixels=null});this.map.on("zoom_changed",function(){hR._mouseEventPixels=null});this.map.on("load",function(){hR._mouseEventPixels=null})}},draw:function(hS){if(!this.domElement){return}var hR=this.map;if(hR.getMapType()==="B_EARTH_MAP"||hR._renderType==="webgl"){return}hS=hS||{};var T=this.points.slice(0);if(this.greatCirclePoints.length>0){T[0]=this.greatCirclePoints}var i=this._getDisplayPixels(T,hS.zoom,hS.center);if(this._drawer){this._drawer.setPath(this.domElement,i)}},_draw:function(){if(this.map){this.initialize(this.map);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}this.draw()}},_getDisplayPixels:function(hV,hW,e){var hR=this.map;var hU=[];if(hV.length==0||!this.isVisible()){return[hU]}if(hR._renderType!=="webgl"&&!this.domElement){return[hU]}var T=hV;if(!this._config.enableEditing&&this._config.enableParse){T=this._simplification(hV)}var hT=[];if(hV[0] instanceof hs){var hX=this._toOverlayPixels(T,hW,e);hT.push(hX.pixels);hT.isOnBack=hX.isOnBack}else{hT.isOnBack=false;for(var hS=0;hS<T.length;hS++){var hX=this._toOverlayPixels(T[hS],hW,e);hT.push(hX.pixels);if(hX.isOnBack===true){hT.isOnBack=true}}}return hT},_toOverlayPixels:function(hW,hZ,e){var T=this.map;var hX;var hY=[];var hV=T.pointToOverlayPixelIn(hW[0],{zoom:hZ,center:e});hY.push(hV);if(hV.onBack){hX=true}for(var hT=1,hS=1,hR=hW.length;hT<hR;hT++){var hU=T.pointToOverlayPixelIn(hW[hT],{zoom:hZ,center:e});if(hU.onBack){hX=true}if(!hU.equals(hY[hS-1])){hY.push(hU);hS++}}return{pixels:hY,isOnBack:hX}},getParseCacheIndex:function(e){e=Math.floor(e);if(this._config.getParseCacheIndex){return this._config.getParseCacheIndex(e)}if(e<6){return 0}if(e<10){return 1}if(e<15){return 2}return 3},getParseTolerance:function(i,e){i=Math.floor(i);if(this._config.getParseTolerance){return this._config.getParseTolerance(i,e)}return w.parseTolerance[e][this.getParseCacheIndex(i)]},setPoints:function(i){this._clearCache();this.points=w.getGraphPoints(i).slice(0);this._calcBounds();this.draw();var e=new bb("onlineupdate");e.overlay=this;this.dispatchEvent(e)},setPointAt:function(T,e){if(!e||!this.points[T]){return}this._clearCache();this.points[T]=new hs(e.lng,e.lat);this._calcBounds();this.draw();var i=new bb("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setPositionAt:function(i,e){if(!e||!this.points[i]){return}var T=en.convertLL2MC(e);this.setPointAt(i,T);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},setOptions:function(i){i=i||{};var T=this.isStyleUseTexture();for(var e in i){if(i.hasOwnProperty(e)){var hS=this._config[e];var hR=i[e];this._config[e]=hR;if(hR!==hS&&(e==="strokeColor"||e==="strokeOpacity"||e==="strokeWeight")){if(this._config.texture){this._config.texture=null}if(T){this._generateTexture()}}if(this.map){this._setDomAttribute(e.toLowerCase(),i[e])}}}},isStyleUseTexture:function(){if(!this.map){return false}if(this.map.getRenderType()!=="webgl"){return false}return this._config.strokeStyle==="dashed"||this._config.strokeStyle==="dotted"},setStrokeColor:function(e){this.setOptions({strokeColor:e})},setStrokeLineCap:function(e){if(this._config){this._config.strokeLineCap=e}this._setDomAttribute("strokelinecap",e)},setStrokeLineJoin:function(e){if(this._config){this._config.strokeLineJoin=e}this._setDomAttribute("strokelinejoin",e)},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e;if(!this.map){return}this._setDomAttribute("strokeweight",e)}},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e;if(!this.map){return}this._setDomAttribute("strokeopacity",e)},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e;this._setDomAttribute("fillopacity",e)},setStrokeStyle:function(e){if(e!="solid"&&e!="dashed"&&e!="dotted"){return}this._config.strokeStyle=e;this._setDomAttribute("strokestyle",e)},setFillColor:function(e){this._config.fillColor=e||"";this._setDomAttribute("fillcolor",e)},_setDomAttribute:function(i,T){if(!w.DOM_ATTRS[i]){return}if(this._drawer){if(T===false||T===null||typeof T==="undefined"){T=""}this._drawer.setAttribute(this.domElement,i,T,this._config)}var e=new bb("onlineupdate");e.overlay=this;this.dispatchEvent(e);if(i==="strokeweight"&&this.getStrokeStyle()==="dashed"&&bw.getDrawer(this.map)&&bw.getDrawer(this.map).getType()==="svg"){this._setDomAttribute("strokestyle","dashed")}},addVertexs:function(){var hV=this;if(hV.vertexMarkers.length){return}var hW=this.getVertexPoints();var hU;for(var hT=0,hR=hW.length;hT<hR;hT++){var e=hW[hT];if(e.t){hU=e3.imgPath+"nodeT.gif"}else{hU=e3.imgPath+"node.gif"}var T=new hb(hU,new d9(11,11),{offset:new d9(5,5)});var hS=new dr(e.p,{icon:T});hS.enableDragging(true);hS.addEventListener("ondragging",function(i){hV._onMarkerDragging(i)});hS.addEventListener("ondragstart",function(i){hV._onMarkerDragstart(i)});hS.addEventListener("ondragend",function(i){hV._onMarkerDragend(i)});hS.addEventListener("onmarkerdelvertex",function(i){hV._onMarkerDelVertex(i)});hS.index=hT;hS.t=e.t;this.vertexMarkers.push(hS);this.map?this.map.addOverlay(hS):""}},clearVertexs:function(){var e;while(e=this.vertexMarkers.pop()){this.map.removeOverlay(e);e=undefined}this.vertexMarkers.length=0},getVertexPoints:function(){var hT=[];for(var hS=0,T=this.points.length;hS<T;hS++){var hU=this.points[hS];hT.push({p:hU,t:0});if(hS<T-1){var e=this.points[hS+1];var hR=new hs((hU.lng+e.lng)/2,(hU.lat+e.lat)/2);hT.push({p:hR,t:1})}}this.vertexPoints=hT;return hT},delVertex:function(e){this.map.removeOverlay(this.vertexMarkers[e]);this.vertexPoints.splice(e,1);this.vertexMarkers.splice(e,1)},_onMarkerDragging:function(i){},_onMarkerDragstart:function(T){this._editstate=false;var i=new bb("oneditstart");i.pixel=T.pixel;i.point=T.point;i.latLng=T.latLng;i.overlay=this;this.dispatchEvent(i)},_onMarkerDragend:function(hV){this.vertexPoints.length=0;this._editstate=false;if(this._temp.dashedLine){this.map.removeOverlay(this._temp.dashedLine);delete this._temp.dashedLine}if(this._temp.preTNode){this.map.removeOverlay(this._temp.preTNode);delete this._temp.preTNode}if(this._temp.nexTNode){this.map.removeOverlay(this._temp.nexTNode);delete this._temp.nexTNode}var hU=hV.currentTarget;var hW=hV.point;var T=hU.index;var hT;if(T%2!=0){T=Math.ceil(T/2);hT=this.points.slice();var hS=this.points.length-T;var hR=hT.splice(T,hS);hT[hT.length]=hW;hT=hT.concat(hR)}else{T=T/2;this.points.splice(T,1,hW);if(this instanceof aR&&this.points.length-1==T){this.points.splice(0,1,hW)}hT=this.points}this.clearVertexs();this.setPoints(hT);this.addVertexs();var i=new bb("oneditend");i.pixel=hV.pixel;i.point=hV.point;i.latLng=hV.latLng;i.overlay=this;this.dispatchEvent(i);this._mouseEventPixels=null},_onMarkerDelVertex:function(hT){if(this.toString()!=="Polyline"&&this.toString()!=="Polygon"){return}if(hT.target.type===0||hT.target.t===0){var hS=[];if(this.vertexPoints.length<4&&this.toString()==="Polyline"){return}if(this.vertexPoints.length<8&&this.toString()==="Polygon"){return}if(this.toString()==="Polygon"&&(hT.target.index===0||hT.target.index===(this.vertexPoints.length-1))){this.delVertex(this.vertexPoints.length-1);this.delVertex(0)}else{this.delVertex(hT.target.index)}for(var hR=0;hR<this.vertexPoints.length;hR++){if(this.vertexPoints[hR].t===0){hS.push(this.vertexPoints[hR].p)}}this.points=hS;if(this.points[0].lng===this.points[this.points.length-1].lng&&this.points[0].lat===this.points[this.points.length-1].lat){this.points.splice(this.points.length-1,1)}this.clearVertexs();this.setPoints(this.points);this.addVertexs();var T=new bb("oneditend");T.pixel=hT.pixel;T.point=hT.point;T.latLng=hT.latLng;T.overlay=this;this.dispatchEvent(T);this._mouseEventPixels=null}},_getInPnpoly:function(T){var hR;var hV=[];var e=this.map.pointToOverlayPixelIn(T);if(this._mouseEventPixels){hV=this._mouseEventPixels}else{if(!(this.points[0] instanceof hs)){var hU=this._getDisplayPixels(this.points);for(var hT=0;hT<hU.length;hT++){hU[hT].push(hU[hT][0]);hV=hV.concat(hU[hT])}}else{hV=this._getDisplayPixels(this.points)[0]}this._mouseEventPixels=hV}var hS=this._pixelPnpoly(e,hV);hR=hS?0:1000;return{pixel:e,dist:hR}},_getProximity:function(h2){var T,hS,h3,hV,hU,h1,h0,hZ=[];var h4=this.map.pointToOverlayPixelIn(h2);if(this._mouseEventPixels){hZ=this._mouseEventPixels}else{hZ=this._getDisplayPixels(this.points)[0];this._mouseEventPixels=hZ}var h7=hZ.length;if(h7>1){for(var h5=1;h5<h7;h5++){var hX=hZ[h5-1];var ib=hZ[h5];if(!hX||!ib){continue}if(hX.x!=ib.x){var ia=(ib.y-hX.y)/(ib.x-hX.x);var h8=ib.y-ia*ib.x;h0=Math.abs(ia*h4.x+h8-h4.y)/Math.sqrt(ia*ia+1)}else{h0=Math.abs(h4.x-ib.x)}var h6=Math.pow(ib.y-hX.y,2)+Math.pow(ib.x-hX.x,2);var hR=Math.pow(ib.y-h4.y,2)+Math.pow(ib.x-h4.x,2);var h9=Math.pow(hX.y-h4.y,2)+Math.pow(hX.x-h4.x,2);var hT=Math.pow(h0,2);var e=hR-hT+h9-hT;if(e>h6){h0=Math.sqrt(Math.min(hR,h9))}if((T==null)||(T>h0)){hS=Math.sqrt(h9-hT)/Math.sqrt(h6);h3=Math.sqrt(hR-hT)/Math.sqrt(h6);T=h0;h1=h5}T=Math.min(T,h0)}if(hS>1){hS=1}if(h3>1){hS=0;h3=1}var hY=hZ[h1-1].x-hZ[h1].x;var hW=hZ[h1-1].y-hZ[h1].y;hV=hZ[h1-1].x-(hY*hS);hU=hZ[h1-1].y-(hW*hS)}return{pixel:new ej(hV,hU),dist:T}},_pixelPnpoly:function(hS,hU){var e=hU.length;var T=0;var hT=false;for(var hR=0;hR<e;hR++){T=(hR===e-1)?0:T+1;if((hU[hR].y!==hU[T].y)&&(((hS.y>=hU[hR].y)&&(hS.y<hU[T].y))||((hS.y>=hU[T].y)&&(hS.y<hU[hR].y)))&&(hS.x<(hU[T].x-hU[hR].x)*(hS.y-hU[hR].y)/(hU[T].y-hU[hR].y)+hU[hR].x)){hT=!hT}}return hT},getMinDistance:function(i){var e=this._getProximity(i);var T=this.map.overlayPixelToPointIn(e.pixel);return this.map.getDistanceIn(i,T)},buildVertex:function(hS,hY){var hV=[];var hZ=[];var h1=this.points.slice(0);var h2=[];if(this.greatCirclePoints.length>0){h1[0]=this.greatCirclePoints}var T=w.JOININDEX[this._config.strokeLineJoin];var h0=w.CAPINDEX[this._config.strokeLineCap];var hR=this.getStrokeColorForGL();var e=this._config.strokeWeight/2;var hU=this.map.getZoom();if(h1.length>500&&h1[0] instanceof hs){if(!hY&&this._lastResult){return this._lastResult}var hX=this._getDisplayPixelsGLWithCut(h1);for(var hT=0;hT<hX.length;hT++){if(hX[hT].length<2){continue}if(hV.length/6+hS.getVertexCount(hX[hT].length)>65536){h2.push([hV,hZ]);hV=[];hZ=[]}hS.buildData(hX[hT],T,h0,hV,hZ,hR,e)}h2.push([hV,hZ]);h2.inCache=false;this._lastResult=h2;return h2}var hW=this.getParseCacheIndex(this.map.getZoom());if(hY!==true&&this._parseCacheGL[hW]){this._parseCacheGL[hW].inCache=true;return this._parseCacheGL[hW]}var hX=this._getDisplayPixelsGL(h1);for(var hT=0;hT<hX.length;hT++){if(hX[hT].length<2){continue}if(hV.length/6+hS.getVertexCount(hX[hT].length)>65536){h2.push([hV,hZ]);hV=[];hZ=[]}hS.buildData(hX[hT],T,h0,hV,hZ,hR,e)}h2.push([hV,hZ]);this._parseCacheGL[hW]=h2;this._parseCacheGL[hW].cacheIndex=hW;return h2},ifInMapView:function(){if(!this.map){return false}if(this.map.getZoom()<5){return true}if(this._config.clip===false){return true}var e=this.map.getBoundsIn();return !!e.intersects(this.getBoundsIn())},_getDisplayPixelsGLWithCut:function(e){return this._getDisplayPixelsGL(e)},_getDisplayPixelsGL:function(hR){var hT=this.map;var hS=[];var hV=[];hS.pointsArray=hV;if(hR.length==0||!this.isVisible()){return[hS]}var hU=hR;if(!this._config.enableEditing&&this._config.enableParse){hU=this._simplification(hR)}var T=[];if(!this.hasMultipleParts){T[0]=this._toOverlayPixelsGL(hU)}else{for(var e=0;e<hU.length;e++){T.push(this._toOverlayPixelsGL(hU[e]))}}return T},_toOverlayPixelsGL:function(hY){var T=this.map;var hX=[];var hU=[];hX.pointsArray=hU;var e=T._polyOverlayBasePoint;var hW=[hY[0].lng-e.lng,hY[0].lat-e.lat];hX.push(hW);hU.push(hW[0],hW[1]);for(var hT=1,hS=1,hR=hY.length;hT<hR;hT++){var hV=[hY[hT].lng-e.lng,hY[hT].lat-e.lat];if(hV[0]!==hX[hS-1][0]||hV[1]!==hX[hS-1][1]){hX.push(hV);hU.push(hV[0],hV[1]);hS++}}return hX},getStrokeColorForGL:function(){var T=this._config.strokeColor.substr(1);var i=this._config.strokeOpacity;var e;if(T.length===3){e=[parseInt(T.substr(0,1)+T.substr(0,1),16),parseInt(T.substr(1,1)+T.substr(1,1),16),parseInt(T.substr(2,1)+T.substr(2,1),16),Math.floor(i*255)]}else{e=[parseInt(T.substr(0,2),16),parseInt(T.substr(2,2),16),parseInt(T.substr(4,2),16),Math.floor(i*255)]}return e},show:function(){cV.prototype.show.call(this);var e=new bb("onlineupdate");e.action="show";e.overlay=this;this.dispatchEvent(e);this.draw();if(this._config.enableEditing===true&&!this._config.geodesic){this.addVertexs()}},hide:function(){cV.prototype.hide.call(this);var e=new bb("onlineupdate");e.action="hide";e.overlay=this;this.dispatchEvent(e);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs()}},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent);this.map.removeEventListener("onclick",this._graphClickEvent);this.map.removeEventListener("ondblclick",this._graphClickEvent);this.map.removeEventListener("onrightclick",this._graphClickEvent);this.map.removeEventListener("onrightdblclick",this._graphClickEvent)}cV.prototype.remove.call(this);this._clearCache();var e=new bb("onlineupdate");e.action="remove";e.overlay=this;this.fire(e);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs()}}});function c2(hT,hR,h0){var hX=false,hV=false,hY=false,h2=new ej(hT.x,hT.y),h1=new ej(hR.x,hR.y),hS=fg(h2,h0),T=fg(h1,h0),hZ;var h4,h3;var hW=h0.minX,hU=h0.minY,i=h0.maxX,e=h0.maxY;do{if(hS.all==0&&T.all==0){hX=true;hY=true}else{if((hS.all&T.all)!=0){hY=true}else{if(hS.all!=0){hZ=hS}else{hZ=T}if(hZ.top){h4=h2.x+(h1.x-h2.x)*(hU-h2.y)/(h1.y-h2.y);h3=hU}else{if(hZ.bottom){h4=h2.x+(h1.x-h2.x)*(e-h2.y)/(h1.y-h2.y);h3=e}else{if(hZ.right){h3=h2.y+(h1.y-h2.y)*(i-h2.x)/(h1.x-h2.x);h4=i}else{if(hZ.left){h3=h2.y+(h1.y-h2.y)*(hW-h2.x)/(h1.x-h2.x);h4=hW}}}}hV=true;if(hZ.all==hS.all){h2.x=Math.round(h4);h2.y=Math.round(h3);hS=fg(h2,h0)}else{h1.x=Math.round(h4);h1.y=Math.round(h3);T=fg(h1,h0)}}}}while(!hY);if(hX){return{pixel0:new ej(h2.x,h2.y),pixel1:new ej(h1.x,h1.y),clip:hV?true:false}}}function fg(i,hS){var T={top:0,bottom:0,right:0,left:0,all:0};var e=i.x,hR=i.y;if(hR<hS.minY){T.top=8;T.all+=T.top}else{if(hR>hS.maxY){T.bottom=4;T.all+=T.bottom}}if(e>hS.maxX){T.right=2;T.all+=T.right}else{if(e<hS.minX){T.left=1;T.all+=T.left}}return T}C.extend(a.prototype,{initialize:function(i){w.prototype.initialize.call(this,i);var e=this._config;this.setOptions({fillColor:"",strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,strokeLineCap:e.strokeLineCap,strokeLineJoin:e.strokeLineJoin,strokeOpacity:e.strokeOpacity});return this.domElement},setPoints:function(hR){this._clearCache();this.points=w.getGraphPoints(hR).slice(0);if(this._config.geodesic===true){this.greatCirclePoints.length=0;for(var T=0;T<this.points.length-1;T++){this.calcGreatCirclePoints(this.points[T],this.points[T+1])}}this._calcBounds();this.draw();var e=new bb("onlineupdate");e.overlay=this;this.dispatchEvent(e)},_getDisplayPixels:function(h3,e,h8){var h9=this.map;var hT=[];if(h3.length===0||!this.isVisible()){return[hT]}if(h9._renderType!=="webgl"&&!this.domElement){return[hT]}if(!((C.Platform.ipad||C.Platform.iphone||C.Platform.android)&&h3.length>5000)&&!this._config.enableEditing){var hU=this.getParseCacheIndex(h9.getZoom());if(this._parseCache[hU]){h3=this._parseCache[hU]}else{var T=hF(h3,this.getParseTolerance(h9.getZoom(),h9.config.coordType));h3=this._parseCache[hU]=T}}var h7;var ia=h9.pointToOverlayPixelIn(h3[0],{zoom:e,center:h8});hT.push(ia);if(ia.onBack){h7=true}for(var h4=1,h1=1,h0=h3.length;h4<h0;h4++){var hS=h9.pointToOverlayPixelIn(h3[h4],{zoom:e,center:h8});if(hS.onBack){h7=true}if(!hS.equals(hT[h1-1])){hT.push(hS);h1++}}var h6=[];var hY=Math.round(h9.offsetX);var hX=Math.round(h9.offsetY);if(h9._renderType==="webgl"){hY=hX=0}var hW=h9.config.drawMargin;var hV={minX:-hY-hW,minY:-hX-hW,maxX:-hY+hW+h9.width,maxY:-hX+hW+h9.height};for(h4=0,h0=hT.length-1;h4<h0;h4++){var h5=hT[h4];var h2=hT[h4+1];var hR=c2(h5,h2,hV);if(hR){h6.push(hR)}}var hZ=[[]];for(h4=0,h0=h6.length;h4<h0;h4++){if(h6[h4].clip){hZ[hZ.length-1].push(h6[h4].pixel0);hZ[hZ.length-1].push(h6[h4].pixel1);if(h6[h4+1]&&h6[h4+1].clip){hZ.push([])}}else{hZ[hZ.length-1].push(h6[h4].pixel0);if(h4===h6.length-1){hZ[hZ.length-1].push(h6[h4].pixel1)}}}hZ.isOnBack=h7;return hZ},_getDisplayPixelsGLWithCut:function(h1){var h6=this.map;var hT=[];if(h1.length===0||!this.isVisible()){return[hT]}if(!this._config.enableEditing){var hU=this.getParseCacheIndex(h6.getZoom());if(this._parseCache[hU]){h1=this._parseCache[hU]}else{var T=hF(h1,this.getParseTolerance(h6.getZoom(),h6.config.coordType));h1=this._parseCache[hU]=T}}var h7=h6._polyOverlayBasePoint;var e=h6.getZoomUnits();if(this._parseCacheGLRaw[hU]){hT=this._parseCacheGLRaw[hU]}else{var h8=new ej(h1[0].lng-h7.lng,h1[0].lat-h7.lat);hT.push(h8);for(var h2=1,hZ=1,hY=h1.length;h2<hY;h2++){var hS=new ej(h1[h2].lng-h7.lng,h1[h2].lat-h7.lat);if(!hS.equals(hT[hZ-1])){hT.push(hS);hZ++}}this._parseCacheGLRaw[hU]=hT}var h5=h6.pixelToPointIn(new ej(0,h6.height));var h4=[];var hW=h6.config.drawMarginGL;var hV={minX:Math.round(-hW*e+(h5.lng-h7.lng)),minY:Math.round(-hW*e+(h5.lat-h7.lat)),maxX:Math.round((hW+h6.width)*e+(h5.lng-h7.lng)),maxY:Math.round((hW+h6.height)*e+(h5.lat-h7.lat))};for(h2=0,hY=hT.length-1;h2<hY;h2++){var h3=hT[h2];var h0=hT[h2+1];var hR=c2(h3,h0,hV);if(hR){h4.push(hR)}}var hX=[[]];for(h2=0,hY=h4.length;h2<hY;h2++){if(h4[h2].clip){hX[hX.length-1].push([h4[h2].pixel0.x,h4[h2].pixel0.y]);hX[hX.length-1].push([h4[h2].pixel1.x,h4[h2].pixel1.y]);if(h4[h2+1]&&h4[h2+1].clip){hX.push([])}}else{hX[hX.length-1].push([h4[h2].pixel0.x,h4[h2].pixel0.y]);if(h2===h4.length-1){hX[hX.length-1].push([h4[h2].pixel1.x,h4[h2].pixel1.y])}}}return hX},_getDisplayPixelsGL:function(hX){var T=this.map;var hW=[];if(hX.length===0||!this.isVisible()){return[hW]}if(this.greatCirclePoints.length>0){hX=this.greatCirclePoints}if(!this._config.enableEditing){var hV=this.getParseCacheIndex(T.getZoom());if(this._parseCache[hV]){hX=this._parseCache[hV]}else{var hY=hF(hX,this.getParseTolerance(T.getZoom(),T.config.coordType));hX=this._parseCache[hV]=hY}}var e=T._polyOverlayBasePoint;hW.push([hX[0].lng-e.lng,hX[0].lat-e.lat]);for(var hT=1,hS=1,hR=hX.length;hT<hR;hT++){var hU=[hX[hT].lng-e.lng,hX[hT].lat-e.lat];if(hU[0]!==hW[hS-1][0]||hU[1]!==hW[hS-1][1]){hW.push(hU);hS++}}hW=[hW];this._addMultipleDrawPath(hW);return hW},_addMultipleDrawPath:function(T,hT,i){if(this._config.clip===true){return}var hS=this.map;hT=hT||hS.getZoom();if(hT>12&&hS.getRenderType()!=="webgl"){return}var e=i?hS.worldSize(hT):c8.WORLD_SIZE_MC;var hR=T.slice(0);C.each(hR,function(hU){var hV=[];C.each(hU,function(hW){if(hW.x){hV.push(new ej(hW.x-e,hW.y))}else{hV.push([hW[0]-e,hW[1]])}});T.push(hV)});C.each(hR,function(hU){var hV=[];C.each(hU,function(hW){if(hW.x){hV.push(new ej(hW.x+e,hW.y))}else{hV.push([hW[0]+e,hW[1]])}});T.push(hV)})},getParsedPoints:function(){var hU=this.map;var i=this.points;var e=[];var T=this;var hT=i.slice(0);hT=[hT];if(this.greatCirclePoints.length>0){hT=[];hT[0]=this.greatCirclePoints}C.each(hT,function(hW){var hV=hF(hW,T.getParseTolerance(hU.getZoom(),hU.config.coordType));e.push(hV)});var hS=0;if(this._bounds.sw.lng<-c8.WORLD_SIZE_MC_HALF){hS=c8.WORLD_SIZE_MC}if(this._bounds.ne.lng>c8.WORLD_SIZE_MC_HALF){hS=-c8.WORLD_SIZE_MC}if(hS===0){return e}var hR=e.slice(0);C.each(hR,function(hV){var hW=[];C.each(hV,function(hX){hW.push(new hs(hX.lng+hS,hX.lat))});e.push(hW)});return e},_onMarkerDragging:function(hX){this._editstate=true;var T=hX.currentTarget;var hZ=hX.point;var hY=T.index;var i=this.vertexPoints;var h0;var hV=null;var hR=null;if(hY===0){var hW=i[hY+2].p;h0=[hZ,hW];hV=new hs((hW.lng+hZ.lng)/2,(hW.lat+hZ.lat)/2);if(this.vertexMarkers[hY+1]){this.vertexMarkers[hY+1].hide()}}else{if(hY===i.length-1){var hU=i[hY-2].p;h0=[hU,hZ];hV=new hs((hU.lng+hZ.lng)/2,(hU.lat+hZ.lat)/2);if(this.vertexMarkers[hY-1]){this.vertexMarkers[hY-1].hide()}}else{var hU=i[hY-1].p;var hW=i[hY+1].p;h0=[hU,hZ,hW];if(!T.t){hU=i[hY-2].p;hW=i[hY+2].p;h0=[hU,hZ,hW];hV=new hs((hU.lng+hZ.lng)/2,(hU.lat+hZ.lat)/2);hR=new hs((hW.lng+hZ.lng)/2,(hW.lat+hZ.lat)/2);if(this.vertexMarkers[hY-1]){this.vertexMarkers[hY-1].hide()}if(this.vertexMarkers[hY+1]){this.vertexMarkers[hY+1].hide()}}}}if(!this._temp.dashedLine){var hT=new a(h0,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(hT);hT.hide();this._temp.dashedLine=hT}else{this._temp.dashedLine.setPoints(h0);this._temp.dashedLine.show()}var hS=new hb(e3.imgPath+"nodeT.gif",new d9(11,11),{offset:new d9(5,5)});if(!this._temp.preTNode&&hV){this._temp.preTNode=new dr(hV,{icon:hS});this.map.addOverlay(this._temp.preTNode)}else{if(hV){this._temp.preTNode.setPoint(hV)}}if(!this._temp.nexTNode&&hR){this._temp.nexTNode=new dr(hR,{icon:hS});this.map.addOverlay(this._temp.nexTNode)}else{if(hR){this._temp.nexTNode.setPoint(hR)}}}});C.extend(ep.prototype,{initialize:function(i){w.prototype.initialize.call(this,i);var e=this._config;this.setOptions({fillColor:"",strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,strokeLineCap:e.strokeLineCap,strokeLineJoin:e.strokeLineJoin,strokeOpacity:e.strokeOpacity});return this.domElement},setPoints:function(i){this._clearCache();this.points=w.getGraphPoints(i).slice(0);this.points=this.calcBezierPoints(this.points,this._cps);this._calcBounds();this.draw();var e=new bb("onlineupdate");e.overlay=this;this.dispatchEvent(e)},_getDisplayPixels:function(h3,e,h8){var h9=this.map;var hT=[];if(h3.length===0||!this.isVisible()){return[hT]}if(h9._renderType!=="webgl"&&!this.domElement){return[hT]}if(!((C.Platform.ipad||C.Platform.iphone||C.Platform.android)&&h3.length>5000)&&!this._config.enableEditing){var hU=this.getParseCacheIndex(h9.getZoom());if(this._parseCache[hU]){h3=this._parseCache[hU]}else{var T=hF(h3,this.getParseTolerance(h9.getZoom(),h9.config.coordType));h3=this._parseCache[hU]=T}}var h7;var ia=h9.pointToOverlayPixelIn(h3[0],{zoom:e,center:h8});hT.push(ia);if(ia.onBack){h7=true}for(var h4=1,h1=1,h0=h3.length;h4<h0;h4++){var hS=h9.pointToOverlayPixelIn(h3[h4],{zoom:e,center:h8});if(hS.onBack){h7=true}if(!hS.equals(hT[h1-1])){hT.push(hS);h1++}}var h6=[];var hY=Math.round(h9.offsetX);var hX=Math.round(h9.offsetY);if(h9._renderType==="webgl"){hY=hX=0}var hW=h9.config.drawMargin;var hV={minX:-hY-hW,minY:-hX-hW,maxX:-hY+hW+h9.width,maxY:-hX+hW+h9.height};for(h4=0,h0=hT.length-1;h4<h0;h4++){var h5=hT[h4];var h2=hT[h4+1];var hR=c2(h5,h2,hV);if(hR){h6.push(hR)}}var hZ=[[]];for(h4=0,h0=h6.length;h4<h0;h4++){if(h6[h4].clip){hZ[hZ.length-1].push(h6[h4].pixel0);hZ[hZ.length-1].push(h6[h4].pixel1);if(h6[h4+1]&&h6[h4+1].clip){hZ.push([])}}else{hZ[hZ.length-1].push(h6[h4].pixel0);if(h4===h6.length-1){hZ[hZ.length-1].push(h6[h4].pixel1)}}}hZ.isOnBack=h7;return hZ},_getDisplayPixelsGLWithCut:function(h1){var h6=this.map;var hT=[];if(h1.length===0||!this.isVisible()){return[hT]}if(!this._config.enableEditing){var hU=this.getParseCacheIndex(h6.getZoom());if(this._parseCache[hU]){h1=this._parseCache[hU]}else{var T=hF(h1,this.getParseTolerance(h6.getZoom(),h6.config.coordType));h1=this._parseCache[hU]=T}}var h7=h6._polyOverlayBasePoint;var e=h6.getZoomUnits();if(this._parseCacheGLRaw[hU]){hT=this._parseCacheGLRaw[hU]}else{var h8=new ej(h1[0].lng-h7.lng,h1[0].lat-h7.lat);hT.push(h8);for(var h2=1,hZ=1,hY=h1.length;h2<hY;h2++){var hS=new ej(h1[h2].lng-h7.lng,h1[h2].lat-h7.lat);if(!hS.equals(hT[hZ-1])){hT.push(hS);hZ++}}this._parseCacheGLRaw[hU]=hT}var h5=h6.pixelToPointIn(new ej(0,h6.height));var h4=[];var hW=h6.config.drawMarginGL;var hV={minX:Math.round(-hW*e+(h5.lng-h7.lng)),minY:Math.round(-hW*e+(h5.lat-h7.lat)),maxX:Math.round((hW+h6.width)*e+(h5.lng-h7.lng)),maxY:Math.round((hW+h6.height)*e+(h5.lat-h7.lat))};for(h2=0,hY=hT.length-1;h2<hY;h2++){var h3=hT[h2];var h0=hT[h2+1];var hR=c2(h3,h0,hV);if(hR){h4.push(hR)}}var hX=[[]];for(h2=0,hY=h4.length;h2<hY;h2++){if(h4[h2].clip){hX[hX.length-1].push([h4[h2].pixel0.x,h4[h2].pixel0.y]);hX[hX.length-1].push([h4[h2].pixel1.x,h4[h2].pixel1.y]);if(h4[h2+1]&&h4[h2+1].clip){hX.push([])}}else{hX[hX.length-1].push([h4[h2].pixel0.x,h4[h2].pixel0.y]);if(h2===h4.length-1){hX[hX.length-1].push([h4[h2].pixel1.x,h4[h2].pixel1.y])}}}return hX},_getDisplayPixelsGL:function(hX){var T=this.map;var hW=[];if(hX.length===0||!this.isVisible()){return[hW]}if(this.greatCirclePoints.length>0){hX=this.greatCirclePoints}if(!this._config.enableEditing){var hV=this.getParseCacheIndex(T.getZoom());if(this._parseCache[hV]){hX=this._parseCache[hV]}else{var hY=hF(hX,this.getParseTolerance(T.getZoom(),T.config.coordType));hX=this._parseCache[hV]=hY}}var e=T._polyOverlayBasePoint;hW.push([hX[0].lng-e.lng,hX[0].lat-e.lat]);for(var hT=1,hS=1,hR=hX.length;hT<hR;hT++){var hU=[hX[hT].lng-e.lng,hX[hT].lat-e.lat];if(hU[0]!==hW[hS-1][0]||hU[1]!==hW[hS-1][1]){hW.push(hU);hS++}}hW=[hW];this._addMultipleDrawPath(hW);return hW},_addMultipleDrawPath:function(T,hT,i){if(this._config.clip===true){return}var hS=this.map;hT=hT||hS.getZoom();if(hT>12&&hS.getRenderType()!=="webgl"){return}var e=i?hS.worldSize(hT):c8.WORLD_SIZE_MC;var hR=T.slice(0);C.each(hR,function(hU){var hV=[];C.each(hU,function(hW){if(hW.x){hV.push(new ej(hW.x-e,hW.y))}else{hV.push([hW[0]-e,hW[1]])}});T.push(hV)});C.each(hR,function(hU){var hV=[];C.each(hU,function(hW){if(hW.x){hV.push(new ej(hW.x+e,hW.y))}else{hV.push([hW[0]+e,hW[1]])}});T.push(hV)})},});C.extend(fl.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);if(this._config.geodesic===true){this.calcGreatCirclePoints(en.convertMC2LL(this.points[0][0]),en.convertMC2LL(this.points[0][1]))}this._calcBounds()},_getDisplayPixels:function(e,hU,hR){var hT=this.map;var T=[];var i=this;var hS=e.slice(0);if(this.greatCirclePoints.length>0){hS[0]=this.greatCirclePoints}C.each(hS,function(hW,hV){var hX=i._getEachDisplayPixels(hW,hV,hU,hR);C.each(hX,function(hY){T.push(hY)})});this._addMultipleDrawPath(T,hU,true);return T},_addMultipleDrawPath:function(T,hT,i){if(this._config.clip===true){return}var hS=this.map;hT=hT||hS.getZoom();if(hT>12&&hS.getRenderType()!=="webgl"){return}var e=i?hS.worldSize(hT):c8.WORLD_SIZE_MC;var hR=T.slice(0);C.each(hR,function(hU){var hV=[];C.each(hU,function(hW){if(hW.x){hV.push(new ej(hW.x-e,hW.y))}else{hV.push([hW[0]-e,hW[1]])}});T.push(hV)});C.each(hR,function(hU){var hV=[];C.each(hU,function(hW){if(hW.x){hV.push(new ej(hW.x+e,hW.y))}else{hV.push([hW[0]+e,hW[1]])}});T.push(hV)})},_getDisplayPixelsGL:function(e){var T=[];var i=this;var hR=e.slice(0);if(this.greatCirclePoints.length>0){hR[0]=this.greatCirclePoints}C.each(hR,function(hT,hS){var hU=i._getEachDisplayPixelsGL(hT,hS);C.each(hU,function(hV){T.push(hV)})});this._addMultipleDrawPath(T);return T},_getEachDisplayPixels:function(h1,hV,hU,hY){var e=this.map;var h0=[];if(h1.length===0||!this.domElement||!this.isVisible()){return[h0]}h1=this._simplification(h1,hV);var hZ;var hX=e.pointToOverlayPixelIn(h1[0],{zoom:hU,center:hY});h0.push(hX);if(hX.onBack){hZ=true}for(var hT=1,hR=1,T=h1.length;hT<T;hT++){var hW=e.pointToOverlayPixelIn(h1[hT],{zoom:hU,center:hY});if(hW.onBack){hZ=true}if(!hW.equals(h0[hR-1])){h0.push(hW);hR++}}if(e.getZoom()<5||this._config.clip===false){return[h0]}var hS=this._clipLine(h0);hS.isOnBack=hZ;return hS},_simplification:function(T,i){if(this._config.enableEditing){return T}var hS=this.map;var hR=this.getParseCacheIndex(hS.getZoom());if(this._parseCache[hR]&&this._parseCache[hR][i]){return this._parseCache[hR][i]}else{var e=hF(T,this.getParseTolerance(hS.getZoom(),hS.config.coordType));if(!this._parseCache[hR]){this._parseCache[hR]=[]}this._parseCache[hR][i]=e;return e}},_clipLine:function(hR){var e=this.map;var hX=[];var h0=Math.round(e.offsetX);var hZ=Math.round(e.offsetY);var h1=e.config.drawMargin;var hT={minX:-h0-h1,minY:-hZ-h1,maxX:-h0+h1+e.width,maxY:-hZ+h1+e.height};for(var hU=0,T=hR.length-1;hU<T;hU++){var hW=hR[hU];var hV=hR[hU+1];var hY=c2(hW,hV,hT);if(hY){hX.push(hY)}}var hS=[[]];for(var hU=0,T=hX.length;hU<T;hU++){if(hX[hU].clip){hS[hS.length-1].push(hX[hU].pixel0);hS[hS.length-1].push(hX[hU].pixel1);if(hX[hU+1]&&hX[hU+1].clip){hS.push([])}}else{hS[hS.length-1].push(hX[hU].pixel0);if(hU===hX.length-1){hS[hS.length-1].push(hX[hU].pixel1)}}}return hS},_getEachDisplayPixelsGL:function(hX,hU){var T=this.map;var hW=[];if(hX.length===0||!this.isVisible()){return[hW]}hX=this._simplification(hX,hU);if(this._config.clip===true){return this._clipLineGL(hX,hU)}var e=T._polyOverlayBasePoint;hW.push([hX[0].lng-e.lng,hX[0].lat-e.lat]);for(var hT=1,hS=1,hR=hX.length;hT<hR;hT++){var hV=[hX[hT].lng-e.lng,hX[hT].lat-e.lat];if(hV[0]!==hW[hS-1][0]||hV[1]!==hW[hS-1][1]){hW.push(hV);hS++}}return[hW]},_clipLineGL:function(h1,hU){var h6=this.map;var hT=this.getParseCacheIndex(h6.getZoom());var h7=h6._polyOverlayBasePoint;var hS=[];if(this._parseCacheGLRaw[hT]&&this._parseCacheGLRaw[hT][hU]){hS=this._parseCacheGLRaw[hT][hU]}else{var h8=new ej(h1[0].lng-h7.lng,h1[0].lat-h7.lat);hS.push(h8);for(var h2=1,hZ=1,hY=h1.length;h2<hY;h2++){var hR=new ej(h1[h2].lng-h7.lng,h1[h2].lat-h7.lat);if(!hR.equals(hS[hZ-1])){hS.push(hR);hZ++}}if(!this._parseCacheGLRaw[hT]){this._parseCacheGLRaw[hT]=[]}this._parseCacheGLRaw[hT][hU]=hS}var e=h6.getZoomUnits();var h5=h6.pixelToPointIn(new ej(0,h6.height));var h4=[];var hW=h6.config.drawMarginGL;var hV={minX:Math.round(-hW*e+(h5.lng-h7.lng)),minY:Math.round(-hW*e+(h5.lat-h7.lat)),maxX:Math.round((hW+h6.width)*e+(h5.lng-h7.lng)),maxY:Math.round((hW+h6.height)*e+(h5.lat-h7.lat))};for(h2=0,hY=hS.length-1;h2<hY;h2++){var h3=hS[h2];var h0=hS[h2+1];var T=c2(h3,h0,hV);if(T){h4.push(T)}}var hX=[[]];for(h2=0,hY=h4.length;h2<hY;h2++){if(h4[h2].clip){hX[hX.length-1].push([h4[h2].pixel0.x,h4[h2].pixel0.y]);hX[hX.length-1].push([h4[h2].pixel1.x,h4[h2].pixel1.y]);if(h4[h2+1]&&h4[h2+1].clip){hX.push([])}}else{hX[hX.length-1].push([h4[h2].pixel0.x,h4[h2].pixel0.y]);if(h2===h4.length-1){hX[hX.length-1].push([h4[h2].pixel1.x,h4[h2].pixel1.y])}}}return hX},getParsedPoints:function(){var hU=this.map;var i=this.points;var e=[];var T=this;var hT=i.slice(0);if(this.greatCirclePoints.length>0){hT[0]=this.greatCirclePoints}C.each(hT,function(hW){var hV=hF(hW,T.getParseTolerance(hU.getZoom(),hU.config.coordType));e.push(hV)});var hS=0;if(this._bounds.sw.lng<-c8.WORLD_SIZE_MC_HALF){hS=c8.WORLD_SIZE_MC}if(this._bounds.ne.lng>c8.WORLD_SIZE_MC_HALF){hS=-c8.WORLD_SIZE_MC}if(hS===0){return e}var hR=e.slice(0);C.each(hR,function(hV){var hW=[];C.each(hV,function(hX){hW.push(new hs(hX.lng+hS,hX.lat))});e.push(hW)});console.log(e);return e},setPointAt:function(T,e,hR){hR=hR||0;if(!e||!this.points[hR][T]||!this.points[hR][T]){return}this._clearCache();this.points[hR][T]=new hs(e.lng,e.lat);if(this._config.geodesic===true){this.calcGreatCirclePoints(en.convertMC2LL(this.points[hR][0]),en.convertMC2LL(this.points[hR][1]))}this._calcBounds();this.draw();var i=new bb("onlineupdate");i.overlay=this;this.dispatchEvent(i)},calcGreatCirclePoints:function(hR,T){if(hR.equals(T)){return}var e=en.getDistance(dK(hR.lng),dK(hR.lat),dK(T.lng),dK(T.lat));if(e<250000){return}this.greatCirclePoints.length=0;var hV=Math.round(e/150000);var hZ=this.calcAngularDistance(hR,T);this.greatCirclePoints.push(this.points[0][0]);var hY=hR.lng;var hX=this.points[0][0];for(var hS=0;hS<hV;hS++){var hU=this.calcMiddlePoint(hR,T,hS/hV,hZ);var hW=en.convertLL2MC(hU);var hT=hW.lng;var h0=bP(hW,hX);if(h0>30037726){if(hW.lng<hX.lng){hW.lng+=c8.WORLD_SIZE_MC}else{hW.lng-=c8.WORLD_SIZE_MC}}this.greatCirclePoints.push(hW);hX=hW}this.greatCirclePoints.push(this.points[0][1]);var h0=bP(this.points[0][1],hX);if(h0>30037726){if(this.points[0][1].lng<hX.lng){this.points[0][1].lng+=c8.WORLD_SIZE_MC}else{this.points[0][1].lng-=c8.WORLD_SIZE_MC}}},calcMiddlePoint:function(hY,hX,hZ,h3){var hS=hY.lat;var hR=hX.lat;var h2=hY.lng;var h0=hX.lng;var h4=dK(hS);var h1=dK(hR);var i=dK(h2);var e=dK(h0);var h6=Math.sin((1-hZ)*h3)/Math.sin(h3);var h5=Math.sin(hZ*h3)/Math.sin(h3);var hV=h6*Math.cos(h4)*Math.cos(i)+h5*Math.cos(h1)*Math.cos(e);var hU=h6*Math.cos(h4)*Math.sin(i)+h5*Math.cos(h1)*Math.sin(e);var hT=h6*Math.sin(h4)+h5*Math.sin(h1);var T=Math.atan2(hT,Math.sqrt(Math.pow(hV,2)+Math.pow(hU,2)));var hW=Math.atan2(hU,hV);return new hs(de(hW),de(T))},calcAngularDistance:function(hS,i){var hT=dK(hS.lat);var hR=dK(i.lat);var T=dK(hS.lng);var e=dK(i.lng);return Math.acos(Math.sin(hT)*Math.sin(hR)+Math.cos(hT)*Math.cos(hR)*Math.cos(Math.abs(e-T)))}});C.extend(aR.prototype,{initialize:function(i){w.prototype.initialize.call(this,i);var e=this._config;this.setOptions({strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,fillColor:e.fillColor,strokeOpacity:e.strokeOpacity,fillOpacity:e.fillOpacity});return this.domElement},setPointAt:function(T,e){if(!this._userPoints[T]){return}this._clearCache();this._userPoints[T]=new hs(e.lng,e.lat);this.points[T]=new hs(e.lng,e.lat);if(T===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new hs(e.lng,e.lat)}this._calcBounds();this.draw();var i=new bb("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setPositionAt:function(i,e){if(!this._userPoints[i]){return}var T=en.convertLL2MC(e);this.setPointAt(i,T);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},_onMarkerDragging:function(hY){this._editstate=true;var hR=hY.currentTarget;var h0=hY.point;var hZ=hR.index;var i=this.vertexPoints;var h2;var hV=i[2].p;var h1=i[i.length-2].p;var hW=null;var T=null;if(hZ===0){var hX=i[hZ+2].p;h2=[h1,h0,hX];if(!hR.t){hW=new hs((h1.lng+h0.lng)/2,(h1.lat+h0.lat)/2);T=new hs((hX.lng+h0.lng)/2,(hX.lat+h0.lat)/2)}}else{if(hZ===i.length-1){var hU=i[hZ-2].p;h2=[hU,h0,hV];if(!hR.t){hW=new hs((hU.lng+h0.lng)/2,(hU.lat+h0.lat)/2);T=new hs((hV.lng+h0.lng)/2,(hV.lat+h0.lat)/2)}}else{var hU=i[hZ-1].p;var hX=i[hZ+1].p;h2=[hU,h0,hX];if(!hR.t){hU=i[hZ-2].p;hX=i[hZ+2].p;h2=[hU,h0,hX];hW=new hs((hU.lng+h0.lng)/2,(hU.lat+h0.lat)/2);T=new hs((hX.lng+h0.lng)/2,(hX.lat+h0.lat)/2);if(this.vertexMarkers[hZ-1]){this.vertexMarkers[hZ-1].hide()}if(this.vertexMarkers[hZ+1]){this.vertexMarkers[hZ+1].hide()}}}}if(!this._temp.dashedLine){var hT=new a(h2,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(hT);this._temp.dashedLine=hT}else{this._temp.dashedLine.setPoints(h2)}var hS=new hb(e3.imgPath+"nodeT.gif",new d9(11,11),{offset:new d9(5,5)});if(!this._temp.preTNode&&hW){this._temp.preTNode=new dr(hW,{icon:hS});this.map.addOverlay(this._temp.preTNode)}else{if(hW){this._temp.preTNode.setPoint(hW)}}if(!this._temp.nexTNode&&T){this._temp.nexTNode=new dr(T,{icon:hS});this.map.addOverlay(this._temp.nexTNode)}else{if(T){this._temp.nexTNode.setPoint(T)}}},getFillStyleForGL:function(){var T=this._config.fillColor.substr(1);var e=this._config.fillOpacity;var i;if(T.length===3){i=[parseInt(T.substr(0,1)+T.substr(0,1),16),parseInt(T.substr(1,1)+T.substr(1,1),16),parseInt(T.substr(2,1)+T.substr(2,1),16),e]}else{i=[parseInt(T.substr(0,2),16),parseInt(T.substr(2,2),16),parseInt(T.substr(4,2),16),e]}this._fillStyleInfoForGL=i.join(",");return this._fillStyleInfoForGL},buildFillVertex:function(hU){var hY=[];var hW=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[hW]){return this._areaCacheGL[hW]}var hX=this._getDisplayPixelsGL(this.points);if(hX.pointsArray&&hX.pointsArray.length<3){this._areaCacheGL[hW]=[[],hY];return this._areaCacheGL[hW]}var hS;var hT=[];var hR=0;for(var T=0;T<hX.length;T++){if(T>0){hR+=hX[T-1].length}hS=hU(hX[T].pointsArray,null,null,hR);for(var e=0,hV=hS.length;e<hV;e+=3){hY.push(hS[e],hS[e+1],hS[e+2])}hT=hT.concat(hX[T].pointsArray)}var hZ=[new Float32Array(hT),new Uint16Array(hY)];this._areaCacheGL[hW]=hZ;return hZ}});C.extend(f8.prototype,{initialize:function(e){aR.prototype.initialize.call(this,e);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return this.domElement},_addDom:function(){if(this.map._renderType==="webgl"){return}var e=this._drawer=bw.getDrawer(this.map);this.domElement=e.addStandardCircle()},draw:function(i){if(!this.domElement){return}i=i||{};var T=this.getDisplayGeometry(i.center,i.zoom);if(this._drawer){this._drawer.setStandardCircleGeometry(this.domElement,T)}},getDisplayGeometry:function(e,i){var T=this.map.pointToOverlayPixelIn(this.point,{zoom:i,center:e});var hS=Math.round(this._radiusMercator/this.map.getZoomUnits(i));var hR={cx:T.x,cy:T.y,radius:hS};return hR},setPoint:function(e,T){if(!e){return}this._clearCache();if(!T){this.vertexPoints=null}this.point=e;this.latLng=en.convertMC2LL(e);this.points=this._getPerimeterPoints(e,this.radius);this._calcBounds();this.draw();var i=new bb("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setRadius:function(e,T){this._clearCache();if(!T){this.vertexPoints=null}this.radius=Math.abs(e);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();this.draw();var i=new bb("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getParseTolerance:function(i,e){if(this._config.getParseTolerance){return this._config.getParseTolerance(i,e)}return f8.parseTolerance[e][this.getParseCacheIndex(i)]},_onMarkerDragging:function(hU){var hS;var hW;var hX;var i=this.map;this._editstate=true;var hR=hU.currentTarget;var hV=hR.index;var T=this.vertexPoints;var hT=T[0].p;var hY=T[T.length-1].p;if(hV==0){hW=hR.point;hX=hY}else{hW=hT;hX=hR.point}hS=en.getDistanceByMC(hW,hX);this.setRadius(hS,true);this.setCenterIn(hW,true)},_onMarkerDragend:function(hS){this._editstate=false;var hR=hS.currentTarget;var T=hR.index;this.vertexPoints[0]={p:this.point,t:0};if(T==1){this.vertexPoints[1]={p:hR.point,t:0}}this.clearVertexs();this.addVertexs();var i=new bb("oneditend");i.pixel=hS.pixel;i.point=hS.point;i.latLng=hS.latLng;i.overlay=this;this.dispatchEvent(i)},getVertexPoints:function(){if(!this.vertexPoints){var e=[];e.push({p:this.point,t:0});e.push({p:this.points[Math.floor(this.points.length*3/4)],t:0});this.vertexPoints=e}return this.vertexPoints}});C.extend(bs.prototype,{initialize:function(i){w.prototype.initialize.call(this,i);var e=this._config;this.setOptions({topFillColor:e.topFillColor,topFillOpacity:e.topFillOpacity,sideFillColor:e.sideFillColor,sideFillOpacity:e.sideFillOpacity,altitude:e.altitude});return this.domElement},setPointAt:function(T,e){if(!this._userPoints[T]){return}this._clearCache();this._userPoints[T]=new hs(e.lng,e.lat);this.points[T]=new hs(e.lng,e.lat);if(T===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new hs(e.lng,e.lat)}this._calcBounds();this.draw();var i=new bb("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getFillStyleForGL:function(){var i=this._config.topFillColor.substr(1);var hS=this._config.topFillOpacity;var T=this._config.sideFillColor.substr(1);var hR=this._config.sideFillOpacity;var e;var hT;if(i.length===3){e=[parseInt(i.substr(0,1)+i.substr(0,1),16),parseInt(i.substr(1,1)+i.substr(1,1),16),parseInt(i.substr(2,1)+i.substr(2,1),16),hS*255]}else{e=[parseInt(i.substr(0,2),16),parseInt(i.substr(2,2),16),parseInt(i.substr(4,2),16),hS*255]}if(T.length===3){hT=[parseInt(T.substr(0,1)+T.substr(0,1),16),parseInt(T.substr(1,1)+T.substr(1,1),16),parseInt(T.substr(2,1)+T.substr(2,1),16),hR*255]}else{hT=[parseInt(T.substr(0,2),16),parseInt(T.substr(2,2),16),parseInt(T.substr(4,2),16),hR*255]}return{top:e,side:hT}},buildFillVertex:function(hT,id){var hS=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[hS]&&!id){return this._areaCacheGL[hS]}var ih=this._getDisplayPixelsGL(this.points);if(ih.pointsArray&&ih.pointsArray.length<3){this._areaCacheGL[hS]={vertex:[],index:[]};return this._areaCacheGL[hS]}var ib=this.getFillStyleForGL();var h4=ib.top;var h8=ib.side;var hX=this._config.altitude;var il=[0,0,1];var hZ=[];var T=[];var ia=0;for(var ie=0;ie<ih.length;ie++){if(ie>0){ia+=(ih[ie-1].length-1)*5}var h7=ih[ie].pointsArray;h7.splice(-2,2);var im=this.getClockwise(h7);if(im){h7=this.rev(h7)}for(var ii=0;ii<h7.length;ii+=2){hZ.push([h7[ii],h7[ii+1],hX,il[0],il[1],il[2],h4[0],h4[1],h4[2],h4[3]])}var e=hT(h7,null,null,ia);for(var ii=0,h2=e.length;ii<h2;ii+=3){T.push(e[ii],e[ii+1],e[ii+2])}for(var ii=0,h9=h7.length;ii<h9;ii+=2){var hY=h7[ii];var hW=h7[ii+1];var h6=[hY,hW,0];var h5=[hY,hW,hX];var hR=ii+2;var hV=ii+3;if(ii===h9-2){hR=0;hV=1}var ik=h7[hR];var ij=h7[hV];var h3=[ik,ij,0];var h1=[ik,ij,hX];var ig=[h3[0]-h6[0],h3[1]-h6[1],h3[2]-h6[2]];var ic=[h5[0]-h6[0],h5[1]-h6[1],h5[2]-h6[2]];var il=[];vec3.cross(il,ig,ic);h6.push(il[0],il[1],il[2]);h5.push(il[0],il[1],il[2]);h3.push(il[0],il[1],il[2]);h1.push(il[0],il[1],il[2]);h6.push(h8[0],h8[1],h8[2],h8[3]);h5.push(h8[0],h8[1],h8[2],h8[3]);h3.push(h8[0],h8[1],h8[2],h8[3]);h1.push(h8[0],h8[1],h8[2],h8[3]);var hU=hZ.length;hZ.push(h6);hZ.push(h5);hZ.push(h3);hZ.push(h1);T.push(hU,hU+2,hU+3,hU,hU+3,hU+1)}}var h0={vertex:this.convertBuilding3dToTypedArray(hZ),index:new Uint16Array(T)};this._areaCacheGL[hS]=h0;return h0},getClockwise:function(hX){var hT=hX.length;if(hT<6){return false}var hR=hX[hT-2];var hW=hX[hT-1];var T=hX[0];var hV=hX[1];var e=hX[2];var hU=hX[3];for(var hS=2;hS<hT;hS+=2){if(hX[hS]>T){hR=hX[hS-2];hW=hX[hS-1];T=hX[hS];hV=hX[hS+1];if(hS+2>=hT){e=hX[0];hU=hX[1]}else{e=hX[hS+2];hU=hX[hS+3]}}}return((T-hR)*(hU-hV)-(hV-hW)*(e-T)<0)},rev:function(hR){var e=[];for(var T=hR.length-1;T>=0;T-=2){e[hR.length-1-T]=hR[T-1];e[hR.length-1-T+1]=hR[T]}return e},convertBuilding3dToTypedArray:function(hU){var T=hU.length;var hR=new Float32Array(T*7);var hT=new DataView(hR.buffer);var e=0;for(var hS=0;hS<hU.length;hS++){e=hS*7;hR[e+0]=hU[hS][0];hR[e+1]=hU[hS][1];hR[e+2]=hU[hS][2];hR[e+3]=hU[hS][3];hR[e+4]=hU[hS][4];hR[e+5]=hU[hS][5];hT.setUint8(e*4+24,hU[hS][6]);hT.setUint8(e*4+25,hU[hS][7]);hT.setUint8(e*4+26,hU[hS][8]);hT.setUint8(e*4+27,hU[hS][9])}return hR}});C.extend(dW.prototype,{initialize:function(e){w.prototype.initialize.call(this,e);return this.domElement},getFillStyleForGL:function(){if(!this._config.url){return}switch(this._config.type){case"image":var e={type:"image",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break;case"video":var e={type:"video",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break;case"canvas":var e={type:"canvas",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break}return this._fillStyleInfoForGL},buildFillVertex:function(hU){var hX=[];var hW=this._getDisplayPixelsGL(this.points);var hS;var hT=[];var hR=0;for(var T=0;T<hW.length;T++){if(T>0){hR+=hW[T-1].length}hS=hU(hW[T].pointsArray,null,null,hR);for(var e=0,hV=hS.length;e<hV;e+=3){hX.push(hS[e],hS[e+1],hS[e+2])}hT=hT.concat(hW[T].pointsArray)}var hY=[new Float32Array(hT),new Uint16Array(hX)];return hY}});function cW(e){this._map=e;this._canvasAttrName={strokeweight:"lineWidth",strokecolor:"strokeStyle",fillcolor:"fillStyle",strokeopacity:"globalAlpha",fillopacity:"globalAlpha"};this._type="canvas"}cW.prototype=new dV();var b1=cW.prototype;b1.addLine=function(){var i=S("canvas");this._map.getPanes().mapPane.appendChild(i);i.style.position="absolute";var e=i.getContext("2d");e.lineCap="round";e.lineJoin="round";e.save();return i};b1.setPath=function(T,i){if(!T){return}var e=T.getContext("2d");this._setCanvasPosition(T);this._clearCanvas(e);var hS=parseInt(T.style.top);var hR=parseInt(T.style.left);e.beginPath();C.each(i,function(hV){if(hV.length===0){return}e.moveTo(hV[0].x-hR,hV[0].y-hS);for(var hU=1,hT=hV.length;hU<hT;hU++){e.lineTo(hV[hU].x-hR,hV[hU].y-hS)}});this._drawCanvas(T)};b1.setAttribute=function(hR,i,hS){if(!hR){return}var e=hR.getContext("2d");var T=this._getAttributeName(i);if(T){e[T]=hS}hR.setAttribute("_"+i,hS||"");e.save();this._clearCanvas(e);this._drawCanvas(hR)};b1._getAttributeName=function(e){return this._canvasAttrName[e]||e};b1._setCanvasPosition=function(hS){var i=this._map;var hX=i.config.drawMargin;var T=i.width+2*hX;var hU=i.height+2*hX;var hR=-i.offsetX-hX;var hT=-i.offsetY-hX;var hW=hS.getContext("2d");var hV={strokeStyle:hW.strokeStyle,fillStyle:hW.fillStyle,globalAlpha:hW.globalAlpha,lineWidth:hW.lineWidth,lineCap:"round",lineJoin:"round"};hS.setAttribute("width",T);hS.setAttribute("height",hU);for(var e in hV){hW[e]=hV[e]}hW.save();var hY=hS.style;hY.top=hT+"px";hY.left=hR+"px"};b1._clearCanvas=function(e){e.clearRect(0,0,9999,9999)};b1._drawCanvas=function(i){var e=i.getContext("2d");e.globalAlpha=i.getAttribute("_fillopacity");if(e.globalAlpha!=0&&i.getAttribute("_fillcolor")){e.fill()}e.globalAlpha=i.getAttribute("_strokeopacity");if(e.globalAlpha!==0&&i.getAttribute("_strokecolor")){e.stroke()}};b1.addStandardCircle=function(){var i=S("canvas");this._map.getPanes().mapPane.appendChild(i);i.style.position="absolute";var e=i.getContext("2d");e.lineCap="round";e.lineJoin="round";e.save();return i};b1.setStandardCircleGeometry=function(hR,hU){if(!hR){return}var T=hR.getContext("2d");this._setCanvasPosition(hR);this._clearCanvas(T);var hT=parseInt(hR.style.top);var hS=parseInt(hR.style.left);var i=hU.cx-hS;var hV=hU.cy-hT;var e=hU.radius;T.beginPath();T.arc(i,hV,e,0,Math.PI*2);this._drawCanvas(hR)};function dV(){}DrawerPrototype=dV.prototype;DrawerPrototype.setPalette=function(){};DrawerPrototype.addLine=function(){throw"addLineæ¥å£æ²¡æå®ç°"};DrawerPrototype.setAttribute=function(){throw"setAttributeæ¥å£æ²¡æå®ç°"};DrawerPrototype.setPath=function(){throw"setPathæ¥å£æ²¡æå®ç°"};DrawerPrototype.getType=function(){return this._type};var bw={getDrawer:function(e){if(e._renderType==="webgl"){return null}if(!bw["_"+e.hashCode]){bw["_"+e.hashCode]={}}switch(e.config.drawer){case BMAP_SVG_DRAWER:return bw.getSvgDrawer(e);case BMAP_VML_DRAWER:return bw.getVmlDrawer(e);case BMAP_CANVAS_DRAWER:return bw.getCanvasDrawer(e);default:break}if(bw.isSupportSvg()){return bw.getSvgDrawer(e)}if(bw.isSupportVml()){return bw.getVmlDrawer(e)}if(bw.isSupportCanvas()){return bw.getCanvasDrawer(e)}},getSvgDrawer:function(e){if(!bw["_"+e.hashCode]._svgDrawer){bw["_"+e.hashCode]._svgDrawer=new fU(e)}return bw["_"+e.hashCode]._svgDrawer},getVmlDrawer:function(e){if(!bw["_"+e.hashCode]._vmlDrawer){bw["_"+e.hashCode]._vmlDrawer=new hx(e)}return bw["_"+e.hashCode]._vmlDrawer},getCanvasDrawer:function(e){if(!bw["_"+e.hashCode]._canvasDrawer){bw["_"+e.hashCode]._canvasDrawer=new cW(e)}return bw["_"+e.hashCode]._canvasDrawer},isSupportVml:function(){if(typeof bw.supportVml!="undefined"){return bw.supportVml}var T=document.body.appendChild(S("div"));T.innerHTML=\'<v:shape id="vml_tester1" adj="1" />\';var i=T.firstChild;if(!i.style){return false}i.style.behavior="url(#default#VML)";var e=i?typeof i.adj=="object":true;T.parentNode.removeChild(T);bw.supportVml=e;return e},isSupportSvg:function(){if(typeof bw.supportSvg=="undefined"){bw.supportSvg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")}return bw.supportSvg},isSupportCanvas:function(){if(typeof bw.supportCanvas=="undefined"){bw.supportCanvas=!!S("canvas").getContext}return bw.supportCanvas}};bo.DrawerSelector=bw;function fU(e){this._map=e;this.SVG_NS="http://www.w3.org/2000/svg";this._svgAttrName={strokeweight:"stroke-width",strokecolor:"stroke",fillcolor:"fill",strokeopacity:"stroke-opacity",fillopacity:"fill-opacity",strokestyle:"stroke-dasharray",strokelinecap:"stroke-linecap",strokelinejoin:"stroke-linejoin"};this._svg=this._createSvg();this._type="svg"}fU.prototype=new dV();var bD=fU.prototype;bD._createSvg=function(){var e=this._svg=S("svg",{},this.SVG_NS);e.setAttribute("version","1.1");e.setAttribute("type","system");var i=e.style;i.position="absolute";i.MozUserSelect="none";this.setPalette();this._map.getPanes().mapPane.appendChild(e);return e};bD.setPalette=function(){if(!this._svg){return}var T=this._svg;var hV=this._map;var i=hV.config.drawMargin;var hS=hV.width+2*i;var e=hV.height+2*i;var hU=-hV.offsetX-i;var hT=-hV.offsetY-i;this.setAttribute(T,"x",hS+"px");this.setAttribute(T,"y",e+"px");this.setAttribute(T,"viewBox",hU+" "+hT+" "+hS+" "+e);var hR=T.style;hR.top=hT+"px";hR.left=hU+"px";hR.width=hS+"px";hR.height=e+"px"};bD.getPalette=function(){return this._svg};bD.setAttribute=function(hS,T,hT,hR,i){if(!hS){return}if(T==="strokestyle"){i=i||{};var hR=i.strokeWeight||4;var e=i.dashArray||null;switch(hT){case"dashed":if(e){hT=e.join(",")}else{hT=hR*2}break;case"dotted":if(i.strokeLineCap==="round"){hT="1,"+2*hR}else{hT=hR}break;default:hT=0;break}}var hU=hT||"none";if(hT===0){hU=0}hS.setAttributeNS(null,this._getAttributeName(T),hU);return hS};bD._getAttributeName=function(e){return this._svgAttrName[e]||e};bD.addLine=function(){var e=S("path",{},this.SVG_NS);this.setAttribute(e,"fill-rule","evenodd");this._svg.appendChild(e);return e};bD.setPath=function(T,e){var i=this._getPathString(e)||"M -9999,-9999";this.setAttribute(T,"d",i)};bD._getPathString=function(e){if(e.length===0){return""}var i=[];C.each(e,function(hS){if(hS.length<2){return}i.push("M "+hS[0].x+" "+hS[0].y+" L");for(var hR=1,T=hS.length;hR<T;hR++){i.push(hS[hR].x);i.push(hS[hR].y)}});return i.join(" ")};bD.addStandardCircle=function(){var e=S("circle",{},this.SVG_NS);this._svg.appendChild(e);return e};bD.setStandardCircleGeometry=function(T,hR){var i=hR.cx;var hS=hR.cy;var e=hR.radius;this.setAttribute(T,"cx",i);this.setAttribute(T,"cy",hS);this.setAttribute(T,"r",e)};function hx(e){this._map=e;this._vmlAttrName={strokeweight:"weight",strokecolor:"color",fillcolor:"color",strokeopacity:"opacity",fillopacity:"opacity",strokestyle:"dashstyle"};this._type="vml"}hx.prototype=new dV();var bi=hx.prototype;bi.setAttribute=function(T,e,hR){if(T){if(e.indexOf("stroke")==0){T=T.getElementsByTagName("stroke")[0]}else{if(e.indexOf("fill")==0){T=T.getElementsByTagName("fill")[0]}}if(e.indexOf("color")>0){if(!hR){T.on=false}else{T.on=true}}if(e=="strokestyle"){switch(hR){case"dashed":hR="4 2 1 2";break;case"dotted":hR="1 1";break;default:hR="solid";break}}if(e=="strokeweight"){hR=hR+"px"}var i=this._getAttributeName(e);T[i]=hR||""}};bi._getAttributeName=function(e){return this._vmlAttrName[e]||e};bi.addLine=function(){var e=[\'<v:shape style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;"\',\'coordsize="1,1" coordorigin="0,0" filled="t" fillcolor="white">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML);" />\',"</v:shape>"].join("");return dI(this._map.getPanes().mapPane,e)};bi.setPath=function(i,e){this.setAttribute(i,"path",this._getPathString(e));if(C.Browser.ie==6){i.style.display="none";i.style.display=""}};bi._getPathString=function(e){if(e.length==0){return""}var i=[];C.each(e,function(hS){if(hS.length<2){return}i.push("m "+hS[0].x+" "+hS[0].y+" l");for(var hR=1,T=hS.length;hR<T;hR++){i.push(hS[hR].x);i.push(hS[hR].y)}i.push("e")});return i.join(" ")||" "};bi.addStandardCircle=function(){var e=[\'<v:oval style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML);" />\',"</v:oval>"].join("");return dI(this._map.getPanes().mapPane,e)};bi.setStandardCircleGeometry=function(T,hR){var i=hR.cx;var hS=hR.cy;var e=hR.radius;T.style.left=(i-e)+"px";T.style.top=(hS-e)+"px";T.style.width=(e*2)+"px";T.style.height=(e*2)+"px";if(C.Browser.ie===6){T.style.display="none";T.style.display=""}};');
